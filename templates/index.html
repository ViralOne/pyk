{% extends "base.html" %}

{% block title %}Kubernetes Dashboard - Home{% endblock %}

{% block content %}
<div class="card">
    <h2><i class="fas fa-search"></i> Search Namespace</h2>
    <form class="pure-form">
        <div class="search-box">
            <input type="text" id="namespace-search" name="namespace" placeholder="Type to search namespaces..." autocomplete="off">
        </div>
    </form>
</div>

<div class="card">
    <h2><i class="fas fa-cube"></i> Pods</h2>
    <div id="podTable" style="display: none;">
        <div class="pure-table-wrapper">
            <table class="pure-table pure-table-striped">
                <thead>
                    <tr>
                        <th>Pod Name</th>
                        <th>Status</th>
                        <th>Image Tag</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                </tbody>
            </table>
        </div>
    </div>
    <div id="no-selection" class="loading">
        <i class="fas fa-info-circle"></i>
        <p>Select a namespace to view pods</p>
    </div>
</div>

<div class="card">
    <h2><i class="fas fa-map"></i> Available Endpoints</h2>
    <table class="pure-table pure-table-striped">
        <thead>
            <tr>
                <th>Service Name</th>
                <th>Path</th>
                <th>Type</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>Pod Health</td>
                <td>/health/< NAMESPACE ></td>
                <td><span class="status healthy">UI</span></td>
            </tr>
            <tr>
                <td>Pod Health API</td>
                <td>/api/health/< NAMESPACE ></td>
                <td><span class="status unknown">JSON API</span></td>
            </tr>
            <tr>
                <td>Docker Images</td>
                <td>/images</td>
                <td><span class="status healthy">UI</span></td>
            </tr>
            <tr>
                <td>Docker Images API</td>
                <td>/api/images</td>
                <td><span class="status unknown">JSON API</span></td>
            </tr>
            <tr>
                <td>Docker Images by Namespace</td>
                <td>/images/< NAMESPACE ></td>
                <td><span class="status healthy">UI</span></td>
            </tr>
            <tr>
                <td>Docker Images by Namespace API</td>
                <td>/api/images/< NAMESPACE ></td>
                <td><span class="status unknown">JSON API</span></td>
            </tr>
        </tbody>
    </table>
</div>
{% endblock %}

{% block extra_scripts %}
<script>
$(document).ready(function() {
    var namespaces = {{ namespaces|tojson|safe }};
    
    function loadNamespacePods(namespace) {
        $("#no-selection").hide();
        $("#podTable").show();
        
        // Show loading state
        $("#podTable tbody").html(`
            <tr>
                <td colspan="4" class="loading">
                    <i class="fas fa-spinner fa-spin"></i>
                    <p>Loading pods...</p>
                </td>
            </tr>
        `);
        
        // Post to get pod data
        $.post('/', { namespace: namespace }, function(data) {
            $("#podTable tbody").empty();
            
            data.forEach(function(pod) {
                const imageTag = pod.image.includes(':') ? pod.image.split(':')[1] : pod.image;
                $("#podTable tbody").append(`
                    <tr>
                        <td>${pod.name}</td>
                        <td><span class="status ${pod.health}">${pod.health}</span></td>
                        <td class="truncate" title="${pod.image}">${imageTag}</td>
                        <td>
                            <a href="/pod/${namespace}/${pod.name}" class="pure-button pure-button-small">
                                <i class="fas fa-info-circle"></i> Details
                            </a>
                        </td>
                    </tr>
                `);
            });
        });
    }
    
    $("#namespace-search").autocomplete({
        source: namespaces,
        minLength: 0,
        select: function(event, ui) {
            if (ui.item) {
                loadNamespacePods(ui.item.value);
            }
        }
    }).focus(function() {
        $(this).autocomplete("search", "");
    });
});
</script>
{% endblock %}
