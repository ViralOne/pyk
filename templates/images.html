{% extends "base.html" %}

{% block title %}Kubernetes Dashboard - Images{% endblock %}

{% block content %}
<div class="card">
    <h2><i class="fas fa-box"></i> Docker Images</h2>
    
    <div class="pure-form">
        <div class="search-box">
            <input type="text" id="filterInput" name="namespace" placeholder="Filter images..." autocomplete="off">
        </div>
    </div>


    <div id="imagesTable">
        <div class="loading">
            <i class="fas fa-spinner fa-spin"></i>
            <p>Loading images...</p>
        </div>
        <table class="pure-table pure-table-striped" style="display: none;">
            <thead>
                <tr>
                    <th>Namespace</th>
                    <th>Pod Name</th>
                    <th>Image</th>
                </tr>
            </thead>
            <tbody>
            </tbody>
        </table>
    </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script>
$(document).ready(function() {
    // Load images
    $.get('/api/images', function(data) {
        const table = $('#imagesTable table');
        const tbody = table.find('tbody');
        const loading = $('#imagesTable .loading');
        
        if (data.length === 0) {
            const icon = $('<i>').addClass('fas fa-info-circle');
            const message = $('<p>').text('No images found');
            loading.empty().append(icon, message);
            return;
        }
        
        data.forEach(function(item) {
            const row = $('<tr></tr>');
            const namespaceLink = $('<a></a>')
                .attr('href', `/namespace/${item.namespace}`)
                .text(item.namespace)
                .css({
                    'color': '#3498db',
                    'text-decoration': 'none'
                })
                .hover(
                    function() { $(this).css('text-decoration', 'underline'); },
                    function() { $(this).css('text-decoration', 'none'); }
                );
            
            row.append(
                $('<td></td>').append(namespaceLink),
                $('<td></td>').text(item.pod_name),
                $('<td></td>').text(item.image)
            );
            tbody.append(row);
        });
        
        loading.hide();
        table.show();
    }).fail(function() {
        $('#imagesTable .loading').html(`
            <i class="fas fa-exclamation-circle"></i>
            <p>Error loading images. Please try again later.</p>
        `);
    });
    
    function debounce(func, wait) {
        let timeout;
        return function executedFunction(...args) {
            const later = () => {
                clearTimeout(timeout);
                func(...args);
            };
            clearTimeout(timeout);
            timeout = setTimeout(later, wait);
        };
    }
    $('#filterInput').on('keyup', debounce(function() {
            const value = $(this).val().toLowerCase();
            $('#imagesTable tbody tr').filter(function() {
                $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1);
            });
    }, 300));
    });
</script>
{% endblock %}
